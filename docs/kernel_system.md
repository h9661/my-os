# ğŸ”® ChanUX Kernel System Documentation

## ğŸ“‹ Overview

ChanUX ì»¤ë„ ì‹œìŠ¤í…œì€ ë¶€íŠ¸ë¡œë”ì—ì„œ ë„˜ê²¨ë°›ì€ ì œì–´ê¶Œì„ í†µí•´ ìš´ì˜ì²´ì œì˜ í•µì‹¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ë¬¸ì„œëŠ” ì»¤ë„ ì§„ì…ì (`kernel_entry.asm`)ê³¼ ë§ì»¤ ìŠ¤í¬ë¦½íŠ¸(`kernel.ld`)ì˜ êµ¬ì¡°ì™€ ë™ì‘ì„ ìƒì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“ Kernel Directory Structure

```
kernel/
â”œâ”€â”€ kernel_entry.asm    # ì»¤ë„ ì§„ì…ì  (32ë¹„íŠ¸ ì–´ì…ˆë¸”ë¦¬)
â”œâ”€â”€ kernel.ld          # ë§ì»¤ ìŠ¤í¬ë¦½íŠ¸ (ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ ì •ì˜)
â”œâ”€â”€ kernel_main.c      # C ì»¤ë„ ë©”ì¸ í•¨ìˆ˜
â””â”€â”€ include/           # í—¤ë” íŒŒì¼ë“¤
    â””â”€â”€ src/           # ì†ŒìŠ¤ íŒŒì¼ë“¤
```

---

## ğŸ”„ Kernel Initialization Flow

```mermaid
graph TD
    A[Stage 2 Bootloader<br/>jmp 0x10000] --> B[kernel_entry.asm<br/>_start ì§„ì…ì ]
    B --> C[ì„¸ê·¸ë¨¼íŠ¸ ë ˆì§€ìŠ¤í„°<br/>ì´ˆê¸°í™”]
    C --> D[ì»¤ë„ ìŠ¤íƒ ì„¤ì •<br/>ESP = 0x90000]
    D --> E[call kernel_main<br/>C í•¨ìˆ˜ í˜¸ì¶œ]
    E --> F[ì»¤ë„ ì£¼ìš” ê¸°ëŠ¥<br/>ì´ˆê¸°í™” ë° ì‹¤í–‰]
    F --> G[ë¬´í•œ ë£¨í”„<br/>(ì •ìƒ ë™ì‘)]
    
    E --> H[kernel_main ë°˜í™˜<br/>(ë¹„ì •ìƒ ìƒí™©)]
    H --> I[cli - ì¸í„°ëŸ½íŠ¸ ë¹„í™œì„±í™”]
    I --> J[hlt - CPU ì •ì§€]
    J --> K[ë¬´í•œ ë£¨í”„<br/>(ì‹œìŠ¤í…œ ì •ì§€)]
    
    style A fill:#99ccff
    style B fill:#ffcc99
    style C fill:#ffcc99
    style D fill:#ffcc99
    style E fill:#99ff99
    style F fill:#99ff99
    style G fill:#99ff99
    style H fill:#ff9999
    style I fill:#ff9999
    style J fill:#ff9999
    style K fill:#ff9999
```

---

## ğŸ“„ Kernel Entry Point (`kernel_entry.asm`)

### ğŸ¯ Primary Functions

| Function | Description | Technical Details |
|----------|-------------|-------------------|
| **Segment Setup** | 32ë¹„íŠ¸ ë³´í˜¸ëª¨ë“œ ì„¸ê·¸ë¨¼íŠ¸ ì´ˆê¸°í™” | DS, ES, FS, GS, SS = 0x10 |
| **Stack Setup** | C í•¨ìˆ˜ í˜¸ì¶œì„ ìœ„í•œ ìŠ¤íƒ ì„¤ì • | ESP = 0x90000 (576KB) |
| **C Interface** | ì–´ì…ˆë¸”ë¦¬ì—ì„œ C ì–¸ì–´ë¡œ ì œì–´ê¶Œ ì´ì–‘ | call kernel_main |
| **Safety Halt** | ë¹„ì •ìƒ ì¢…ë£Œ ì‹œ ì‹œìŠ¤í…œ ì•ˆì „ ì •ì§€ | cli + hlt + loop |

### ğŸ—ï¸ Memory Layout (Kernel Entry)

```
Physical Memory Address    Purpose                     State
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x10000             â”‚ _start (ì§„ì…ì )          â”‚ ì‹¤í–‰ ì¤‘     â”‚ â† ë¶€íŠ¸ë¡œë” jmp
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x10000 + offset    â”‚ .text (ì½”ë“œ ì„¹ì…˜)        â”‚ ì‹¤í–‰ ê°€ëŠ¥   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì½”ë“œ ë + offset    â”‚ .rodata (ì½ê¸°ì „ìš© ë°ì´í„°) â”‚ ì½ê¸° ì „ìš©   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ rodata ë + offset  â”‚ .data (ì´ˆê¸°í™”ëœ ë°ì´í„°)   â”‚ ì½ê¸°/ì“°ê¸°   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ data ë + offset    â”‚ .bss (ë¯¸ì´ˆê¸°í™” ë°ì´í„°)    â”‚ 0ìœ¼ë¡œ ì´ˆê¸°í™” â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ~0x18000            â”‚ ì»¤ë„ ë (__kernel_end)   â”‚ ì—¬ìœ  ê³µê°„   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x90000 â†“          â”‚ ì»¤ë„ ìŠ¤íƒ (ì•„ë˜ë¡œ ì„±ì¥)   â”‚ í™œì„±        â”‚ â† ESP ì‹œì‘ì 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ Key Operations

#### 1. 32ë¹„íŠ¸ ë³´í˜¸ëª¨ë“œ ì„¸ê·¸ë¨¼íŠ¸ ì„¤ì •
```asm
; ë¶€íŠ¸ë¡œë”ì—ì„œ ì„¤ì •í•œ GDT ì‚¬ìš©
mov ax, 0x10        ; ë°ì´í„° ì„¸ê·¸ë¨¼íŠ¸ ì…€ë ‰í„° (GDT ì¸ë±ìŠ¤ 2)
mov ds, ax          ; DS = ë°ì´í„° ì„¸ê·¸ë¨¼íŠ¸
mov es, ax          ; ES = ì¶”ê°€ ì„¸ê·¸ë¨¼íŠ¸  
mov fs, ax          ; FS = ì¶”ê°€ ì„¸ê·¸ë¨¼íŠ¸
mov gs, ax          ; GS = ì¶”ê°€ ì„¸ê·¸ë¨¼íŠ¸
mov ss, ax          ; SS = ìŠ¤íƒ ì„¸ê·¸ë¨¼íŠ¸
```

#### 2. ì»¤ë„ ìŠ¤íƒ ì´ˆê¸°í™”
```asm
mov esp, 0x90000    ; 576KB ìœ„ì¹˜ì— ìŠ¤íƒ í¬ì¸í„° ì„¤ì •
                    ; C í•¨ìˆ˜ í˜¸ì¶œ, ì§€ì—­ë³€ìˆ˜, ë¦¬í„´ ì£¼ì†Œìš©
```

#### 3. C ì»¤ë„ í˜¸ì¶œ ë° ì•ˆì „ ì •ì§€
```asm
call kernel_main    ; C ì–¸ì–´ ì»¤ë„ë¡œ ì œì–´ê¶Œ ì´ì–‘
cli                 ; ì¸í„°ëŸ½íŠ¸ ë¹„í™œì„±í™” (ë¹„ì •ìƒ ë°˜í™˜ ì‹œ)
.loop:
    hlt             ; CPU ì €ì „ë ¥ ëŒ€ê¸°
    jmp .loop       ; ë¬´í•œ ë£¨í”„
```

---

## ğŸ“„ Linker Script (`kernel.ld`)

### ğŸ¯ Primary Functions

| Function | Description | Memory Impact |
|----------|-------------|---------------|
| **Entry Point** | ì»¤ë„ ì‹¤í–‰ ì‹œì‘ì  ì •ì˜ | ENTRY(_start) |
| **Section Layout** | ì½”ë“œ/ë°ì´í„° ì„¹ì…˜ ë°°ì¹˜ ê·œì¹™ | ì—°ì† ë©”ëª¨ë¦¬ ë°°ì¹˜ |
| **Memory Mapping** | ë¬¼ë¦¬ ì£¼ì†Œ ë§¤í•‘ ì •ì˜ | 0x10000 ì‹œì‘ |
| **Symbol Export** | ì»¤ë„ í¬ê¸° ì¶”ì ìš© ì‹¬ë³¼ | __kernel_end |

### ğŸ—ï¸ Section Layout

```
Linker Script Sections    Physical Address    Purpose
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENTRY(_start)       â”‚ Link-time       â”‚ ì»¤ë„ ì§„ì…ì  ì •ì˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ . = 0x10000        â”‚ 0x10000         â”‚ ë¡œë“œ ì£¼ì†Œ ì„¤ì • (64KB)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .text :             â”‚ 0x10000+        â”‚ ì‹¤í–‰ ì½”ë“œ ì„¹ì…˜            â”‚
â”‚   *(.text)          â”‚                 â”‚ - kernel_entry.o          â”‚
â”‚                     â”‚                 â”‚ - kernel_main.o           â”‚
â”‚                     â”‚                 â”‚ - ê¸°íƒ€ .o íŒŒì¼ë“¤          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .rodata : ALIGN(4)  â”‚ .text ë+       â”‚ ì½ê¸° ì „ìš© ë°ì´í„°          â”‚
â”‚   *(.rodata)        â”‚                 â”‚ - ë¬¸ìì—´ ìƒìˆ˜             â”‚
â”‚   *(.rodata.*)      â”‚                 â”‚ - const ë³€ìˆ˜ë“¤            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .data : ALIGN(4)    â”‚ .rodata ë+     â”‚ ì´ˆê¸°í™”ëœ ì „ì—­ ë³€ìˆ˜        â”‚
â”‚   *(.data)          â”‚                 â”‚ - int global = 42;        â”‚
â”‚   *(.data.*)        â”‚                 â”‚ - ì´ˆê¸°ê°’ ìˆëŠ” ë°ì´í„°      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .bss : ALIGN(4)     â”‚ .data ë+       â”‚ ë¯¸ì´ˆê¸°í™” ì „ì—­ ë³€ìˆ˜        â”‚
â”‚   __bss_start = .   â”‚                 â”‚ - int array[1000];        â”‚
â”‚   *(COMMON)         â”‚                 â”‚ - 0ìœ¼ë¡œ ìë™ ì´ˆê¸°í™”       â”‚
â”‚   *(.bss)           â”‚                 â”‚                          â”‚
â”‚   __bss_end = .     â”‚                 â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ __kernel_end = .    â”‚ .bss ë         â”‚ ì»¤ë„ ì „ì²´ í¬ê¸° í‘œì‹œ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ Key Configurations

#### 1. ì¶œë ¥ í˜•ì‹ ë° ì•„í‚¤í…ì²˜
```ld
OUTPUT_FORMAT(elf32-i386)    ; 32ë¹„íŠ¸ ELF í˜•ì‹
OUTPUT_ARCH(i386)            ; Intel x86 32ë¹„íŠ¸ ì•„í‚¤í…ì²˜
ENTRY(_start)                ; ì§„ì…ì  ì‹¬ë³¼
```

#### 2. ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ ìµœì í™”
```ld
. = 0x10000;                 ; ë¶€íŠ¸ë¡œë”ì™€ ì¼ì¹˜í•˜ëŠ” ë¡œë“œ ì£¼ì†Œ

.text : { *(.text) }         ; ì½”ë“œ ì„¹ì…˜ (ì—°ì† ë°°ì¹˜)
.rodata : ALIGN(4) { ... }   ; 4ë°”ì´íŠ¸ ì •ë ¬ (CPU íš¨ìœ¨ì„±)
.data : ALIGN(4) { ... }     ; ì´ˆê¸°í™”ëœ ë°ì´í„°
.bss : ALIGN(4) { ... }      ; ë¯¸ì´ˆê¸°í™” ë°ì´í„° (0 ì´ˆê¸°í™”)
```

#### 3. ì‹¬ë³¼ ì •ì˜
```ld
__bss_start = .;             ; BSS ì„¹ì…˜ ì‹œì‘ ì£¼ì†Œ
__bss_end = .;               ; BSS ì„¹ì…˜ ë ì£¼ì†Œ  
__kernel_end = .;            ; ì»¤ë„ ì „ì²´ ë ì£¼ì†Œ
```

---

## ğŸ”— Boot-to-Kernel Handoff

### ì •ë³´ ì „ë‹¬ ê³¼ì •

```mermaid
sequenceDiagram
    participant S2 as Stage 2 Bootloader
    participant KE as kernel_entry.asm
    participant KC as kernel_main.c
    
    S2->>KE: jmp 0x10000 (32-bit mode)
    Note over S2,KE: ë³´í˜¸ëª¨ë“œ, GDT ì„¤ì • ì™„ë£Œ
    
    KE->>KE: ì„¸ê·¸ë¨¼íŠ¸ ë ˆì§€ìŠ¤í„° ì´ˆê¸°í™”
    KE->>KE: ìŠ¤íƒ ì„¤ì • (ESP = 0x90000)
    
    KE->>KC: call kernel_main
    Note over KE,KC: C ì–¸ì–´ë¡œ ì œì–´ê¶Œ ì´ì–‘
    
    KC->>KC: ì»¤ë„ ì´ˆê¸°í™” ë° ì‹¤í–‰
    Note over KC: VGA, ì¸í„°ëŸ½íŠ¸, ë©”ëª¨ë¦¬ ë“±
    
    KC-->>KE: return (ë¹„ì •ìƒ ìƒí™©)
    KE->>KE: cli + hlt + loop
    Note over KE: ì‹œìŠ¤í…œ ì•ˆì „ ì •ì§€
```

### ë©”ëª¨ë¦¬ ìƒíƒœ ì „ë‹¬

| í•­ëª© | Stage 2 ì„¤ì • | Kernel Entry ì‚¬ìš© |
|------|--------------|-------------------|
| **CPU ëª¨ë“œ** | 32ë¹„íŠ¸ ë³´í˜¸ëª¨ë“œ | ê·¸ëŒ€ë¡œ ì‚¬ìš© |
| **GDT** | ê¸°ë³¸ Code/Data ì„¸ê·¸ë¨¼íŠ¸ | ì„¸ê·¸ë¨¼íŠ¸ ë ˆì§€ìŠ¤í„° ì´ˆê¸°í™” |
| **A20** | í™œì„±í™”ë¨ | 1MB+ ë©”ëª¨ë¦¬ ì ‘ê·¼ ê°€ëŠ¥ |
| **ìŠ¤íƒ** | 0x90000 (32ë¹„íŠ¸ìš©) | ESP ì¬ì„¤ì • |
| **ì»¤ë„** | 0x10000ì— ë¡œë“œë¨ | í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ì‹¤í–‰ |

---

## ğŸ’¾ Memory Safety & Layout

### ì»¤ë„ ë©”ëª¨ë¦¬ ë³´í˜¸

```
Memory Protection Zones:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x00000 - 0x07FFF: ì €ë©”ëª¨ë¦¬ ì˜ì—­ (32KB)                     â”‚
â”‚ â”œâ”€ BIOS ë°ì´í„°, ì¸í„°ëŸ½íŠ¸ ë²¡í„° í…Œì´ë¸”                         â”‚
â”‚ â””â”€ ì»¤ë„ì´ ì ‘ê·¼í•˜ì§€ ì•ŠëŠ” ì•ˆì „ ì˜ì—­                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x10000 - 0x18000: ì»¤ë„ ì½”ë“œ/ë°ì´í„° ì˜ì—­ (~32KB)            â”‚
â”‚ â”œâ”€ .text: ì‹¤í–‰ ì½”ë“œ (ì½ê¸°/ì‹¤í–‰)                             â”‚
â”‚ â”œâ”€ .rodata: ìƒìˆ˜ ë°ì´í„° (ì½ê¸° ì „ìš©)                         â”‚
â”‚ â”œâ”€ .data: ì „ì—­ ë³€ìˆ˜ (ì½ê¸°/ì“°ê¸°)                             â”‚
â”‚ â””â”€ .bss: ë¯¸ì´ˆê¸°í™” ë°ì´í„° (ì½ê¸°/ì“°ê¸°, 0 ì´ˆê¸°í™”)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x18000 - 0x8FFFF: ììœ  ë©”ëª¨ë¦¬ ì˜ì—­ (~480KB)                â”‚
â”‚ â”œâ”€ ë™ì  ë©”ëª¨ë¦¬ í• ë‹¹ ì˜ì—­                                    â”‚
â”‚ â”œâ”€ í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ê³µê°„                                     â”‚
â”‚ â””â”€ ì»¤ë„ í™•ì¥ ì˜ì—­                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x90000 - 0x9FFFF: ì»¤ë„ ìŠ¤íƒ ì˜ì—­ (64KB)                   â”‚
â”‚ â”œâ”€ í•¨ìˆ˜ í˜¸ì¶œ ìŠ¤íƒ                                           â”‚
â”‚ â”œâ”€ ì§€ì—­ ë³€ìˆ˜ ì €ì¥                                           â”‚
â”‚ â””â”€ ì¸í„°ëŸ½íŠ¸ í•¸ë“¤ëŸ¬ ìŠ¤íƒ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìŠ¤íƒ ì•ˆì „ì„±

```
Stack Growth Direction:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x9FFFF: ìŠ¤íƒ ìµœëŒ€ í¬ê¸° í•œê³„         â”‚ â† ìŠ¤íƒ ì˜¤ë²„í”Œë¡œ ë°©ì§€
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â†‘ ìŠ¤íƒ ì„±ì¥ ë°©í–¥            â”‚
â”‚         â”‚                          â”‚
â”‚ í•¨ìˆ˜ í˜¸ì¶œ í”„ë ˆì„ë“¤                   â”‚
â”‚ - ë¦¬í„´ ì£¼ì†Œ                         â”‚
â”‚ - í•¨ìˆ˜ íŒŒë¼ë¯¸í„°                     â”‚
â”‚ - ì§€ì—­ ë³€ìˆ˜                         â”‚
â”‚         â”‚                          â”‚
â”‚         â†“                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x90000: ESP ì´ˆê¸°ê°’                 â”‚ â† kernel_entryì—ì„œ ì„¤ì •
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Build Process Integration

### ì»´íŒŒì¼ ë° ë§í‚¹ ê³¼ì •

```mermaid
graph LR
    A[kernel_entry.asm] --> B[nasm -f elf32]
    B --> C[kernel_entry.o]
    
    D[kernel_main.c] --> E[gcc -m32 -c]
    E --> F[kernel_main.o]
    
    G[ê¸°íƒ€ .c íŒŒì¼ë“¤] --> H[gcc -m32 -c]
    H --> I[*.o íŒŒì¼ë“¤]
    
    C --> J[ld -T kernel.ld]
    F --> J
    I --> J
    
    J --> K[kernel.bin]
    
    style A fill:#ffcc99
    style D fill:#ffcc99
    style G fill:#ffcc99
    style K fill:#99ff99
```

### ë§ì»¤ ëª…ë ¹ì–´ ì˜ˆì‹œ

```bash
# ì–´ì…ˆë¸”ë¦¬ ì»´íŒŒì¼
nasm -f elf32 kernel/kernel_entry.asm -o build/kernel_entry.o

# C íŒŒì¼ ì»´íŒŒì¼  
gcc -m32 -c kernel/kernel_main.c -o build/kernel_main.o

# ë§í‚¹ (kernel.ld ì‚¬ìš©)
ld -T kernel/kernel.ld -m elf_i386 \
   build/kernel_entry.o \
   build/kernel_main.o \
   build/*.o \
   -o build/kernel.bin
```

---

## ğŸš¨ Error Handling & Debugging

### ì»¤ë„ ë ˆë²¨ ì˜¤ë¥˜ ì²˜ë¦¬

| ì˜¤ë¥˜ ìƒí™© | ê°ì§€ ë°©ë²• | ì²˜ë¦¬ ë°©ì‹ |
|-----------|-----------|-----------|
| **ìŠ¤íƒ ì˜¤ë²„í”Œë¡œ** | ESP < 0x90000 ê²€ì‚¬ | íŒ¨ë‹‰ ë©”ì‹œì§€ + ì‹œìŠ¤í…œ ì •ì§€ |
| **ì»¤ë„ ë©”ëª¨ë¦¬ ì†ìƒ** | ì²´í¬ì„¬, ê°€ë“œ í˜ì´ì§€ | ë©”ëª¨ë¦¬ ë¤í”„ + ì¬ë¶€íŒ… |
| **ì˜ëª»ëœ í•¨ìˆ˜ í˜¸ì¶œ** | ë¦¬í„´ ì£¼ì†Œ ê²€ì¦ | ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ + ì •ì§€ |
| **kernel_main ë°˜í™˜** | _startì—ì„œ ê°ì§€ | CLI + HLT ë¬´í•œë£¨í”„ |

### ë””ë²„ê¹… ë„êµ¬

#### 1. ë©”ëª¨ë¦¬ ë¤í”„ í•¨ìˆ˜
```c
void debug_memory_dump(void* addr, size_t size) {
    // ë©”ëª¨ë¦¬ ë‚´ìš©ì„ VGAì— 16ì§„ìˆ˜ë¡œ ì¶œë ¥
    // ì»¤ë„ ìƒíƒœ ë¶„ì„ìš©
}
```

#### 2. ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
```c
void debug_stack_trace(void) {
    // EBP ì²´ì¸ì„ ë”°ë¼ í•¨ìˆ˜ í˜¸ì¶œ ìŠ¤íƒ ì¶”ì 
    // í•¨ìˆ˜ ë°˜í™˜ ì£¼ì†Œë“¤ì„ ì¶œë ¥
}
```

#### 3. ì»¤ë„ ì‹¬ë³¼ ì •ë³´
```bash
# ì»¤ë„ ë°”ì´ë„ˆë¦¬ì—ì„œ ì‹¬ë³¼ ì •ë³´ ì¶”ì¶œ
objdump -t build/kernel.bin | grep -E "(kernel_end|bss_start)"
```

---

## ğŸ” Advanced Features

### 1. ë™ì  ë©”ëª¨ë¦¬ ê´€ë¦¬ ì¤€ë¹„

```c
extern char __kernel_end;    // ë§ì»¤ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì •ì˜
void* heap_start = &__kernel_end;  // í™ ì‹œì‘ì 
void* heap_end = (void*)0x90000;   // í™ ëì  (ìŠ¤íƒ ì‹œì‘ ì „)
```

### 2. BSS ì„¹ì…˜ ì´ˆê¸°í™”

```c
extern char __bss_start, __bss_end;

void clear_bss(void) {
    char* bss = &__bss_start;
    while (bss < &__bss_end) {
        *bss++ = 0;
    }
}
```

### 3. ì»¤ë„ ì •ë³´ êµ¬ì¡°ì²´

```c
typedef struct {
    void* kernel_start;     // 0x10000
    void* kernel_end;       // __kernel_end
    size_t kernel_size;     // ì»¤ë„ ì „ì²´ í¬ê¸°
    void* heap_start;       // ë™ì  ë©”ëª¨ë¦¬ ì‹œì‘
    void* stack_base;       // 0x90000
} kernel_info_t;
```

---

## ğŸ“š Technical Specifications

### ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ ìƒìˆ˜

| ìƒìˆ˜ | ê°’ | ìš©ë„ |
|------|----|----- |
| `KERNEL_LOAD_ADDR` | 0x10000 | ì»¤ë„ ë¡œë“œ ì£¼ì†Œ |
| `KERNEL_STACK_BASE` | 0x90000 | ìŠ¤íƒ ê¸°ì¤€ì  |
| `KERNEL_MAX_SIZE` | 0x8000 | ìµœëŒ€ ì»¤ë„ í¬ê¸° (32KB) |
| `HEAP_START` | `__kernel_end` | ë™ì  ë©”ëª¨ë¦¬ ì‹œì‘ |
| `HEAP_MAX_SIZE` | ~480KB | ì‚¬ìš© ê°€ëŠ¥í•œ í™ í¬ê¸° |

### GDT ì„¸ê·¸ë¨¼íŠ¸ êµ¬ì¡°

```
GDT Index    Selector    Description
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0       â”‚ 0x00    â”‚ Null Descriptor (í•„ìˆ˜)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1       â”‚ 0x08    â”‚ Code Segment (ì»¤ë„ ì½”ë“œ)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2       â”‚ 0x10    â”‚ Data Segment (ì»¤ë„ ë°ì´í„°)    â”‚ â† kernel_entryì—ì„œ ì‚¬ìš©
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•¨ìˆ˜ í˜¸ì¶œ ê·œì•½ (cdecl)

```
Stack Frame Layout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† ë†’ì€ ì£¼ì†Œ
â”‚ í•¨ìˆ˜ íŒŒë¼ë¯¸í„° N                  â”‚
â”‚ í•¨ìˆ˜ íŒŒë¼ë¯¸í„° 2                  â”‚  
â”‚ í•¨ìˆ˜ íŒŒë¼ë¯¸í„° 1                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë¦¬í„´ ì£¼ì†Œ (call ë‹¤ìŒ ëª…ë ¹ì–´)      â”‚ â† call ëª…ë ¹ì–´ê°€ push
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì´ì „ EBP (ë°±ì—…)                 â”‚ â† í•¨ìˆ˜ í”„ë¡¤ë¡œê·¸ì—ì„œ push ebp
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† EBP ìœ„ì¹˜ (mov ebp, esp)
â”‚ ì§€ì—­ ë³€ìˆ˜ë“¤                     â”‚
â”‚         ...                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† ESP ìœ„ì¹˜ (í˜„ì¬ ìŠ¤íƒ í†±)
â”‚ (ìŠ¤íƒ í™•ì¥ ê³µê°„)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â† ë‚®ì€ ì£¼ì†Œ
```

---

## ğŸ¯ Performance Considerations

### 1. ë©”ëª¨ë¦¬ ì •ë ¬ ìµœì í™”

- **4ë°”ì´íŠ¸ ì •ë ¬**: CPU ìºì‹œ íš¨ìœ¨ì„± í–¥ìƒ
- **ì—°ì† ë°°ì¹˜**: í˜ì´ì§€ í´íŠ¸ ìµœì†Œí™”
- **ì„¹ì…˜ ë¶„ë¦¬**: ì½”ë“œ/ë°ì´í„° ë³´í˜¸ ê°•í™”

### 2. ìŠ¤íƒ í¬ê¸° ìµœì í™”

- **64KB ìŠ¤íƒ**: ê¹Šì€ í•¨ìˆ˜ í˜¸ì¶œ ì§€ì›
- **ìŠ¤íƒ ê°€ë“œ**: ì˜¤ë²„í”Œë¡œ ê°ì§€ ë° ë°©ì§€
- **ì¸í„°ëŸ½íŠ¸ ìŠ¤íƒ**: ë³„ë„ ìŠ¤íƒìœ¼ë¡œ ì•ˆì „ì„± í™•ë³´

### 3. ì»¤ë„ í¬ê¸° ì œí•œ

- **32KB ì œí•œ**: ë¶€íŠ¸ë¡œë” í˜¸í™˜ì„± ìœ ì§€
- **ì„¹ì…˜ ìµœì í™”**: ë¶ˆí•„ìš”í•œ íŒ¨ë”© ì œê±°
- **ì½”ë“œ ì••ì¶•**: ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ìµœì í™”

---

*ì´ ë¬¸ì„œëŠ” ChanUX ìš´ì˜ì²´ì œì˜ ì»¤ë„ ì‹œìŠ¤í…œ êµ¬ì¡°ì™€ ë™ì‘ ì›ë¦¬ë¥¼ ì™„ì „íˆ ë‹¤ë£¹ë‹ˆë‹¤. ë¶€íŠ¸ë¡œë”ì—ì„œ ì»¤ë„ë¡œì˜ ì•ˆì „í•œ ì œì–´ê¶Œ ì´ì–‘ê³¼ íš¨ìœ¨ì ì¸ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì„ í†µí•´ ì•ˆì •ì ì¸ ì»¤ë„ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.*
